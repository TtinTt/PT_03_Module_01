<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Register</title>

    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-KK94CHFLLe+nY2dmCWGMq91rCGa5gtU4mk92HdvYe+M/SXH301p5ILy+dN9+nJOZ"
      crossorigin="anonymous"
    />
    <link rel="stylesheet" href="/LoginRegister.css" />

    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-ENjdO4Dr2bkBIFxQpeoTz1HIcje39Wm4jDKdf19U8gI4ddQ3GYNS7NTKfAdVQSZe"
      crossorigin="anonymous"
    ></script>
    <style>
      form {
        width: 500px;
        margin: 50px auto;
      }
    </style>
    <script src="/Admin/ProductManage.js"></script>
    <script src="/Admin/UserManage.js"></script>
    <script src="/Admin/OrderManage.js"></script>
  </head>
  <body>
    <ul class="nav">
      <li class="nav-item">
        <nav class="navbar">
          <div onclick="HomePage()" class="logo-set-small">
            <img
              id="icon-logo"
              style="width: 30px; height: 30px"
              src="/imgs/TnG Logo - 50x50.png"
              alt=""
            />
            <h5>HANDMADE TnG</h5>
          </div>
        </nav>
      </li>
      <nav class="set-header">
        <li class="navbar"></li>
        <div id="renderButtonHeader"></div>
      </nav>
    </ul>
    <form>
      <h3 style="text-align: center; padding: 20px">ĐĂNG KÝ</h3>
      <div class="mb-3">
        <label for="email" class="form-label">Email</label>
        <input
          type="email"
          class="form-control"
          id="email"
          aria-describedby="emailHelp"
        />
      </div>

      <div class="mb-3">
        <label for="password" class="form-label">Mật khẩu</label>
        <input type="password" class="form-control" id="password" />
      </div>
      <div class="mb-3">
        <label for="confirm-password" class="form-label"
          >Nhập lại mật khẩu</label
        >
        <input type="password" class="form-control" id="confirm-password" />
      </div>
      <h6>
        Nếu bạn đã có tài khoản, vui lòng
        <span style="color: #a11515" onclick="LoginPage()">đăng nhập</span>
      </h6>
      <p
        id="Error"
        style="color: #a11515; padding: 20px; text-align: center"
      ></p>

      <div style="text-align: center">
        <button
          style="display: inline-block; width: 30%"
          type="submit"
          class="btn btn-danger"
        >
          Xác nhận
        </button>
      </div>
    </form>

    <script>
      // Runn ______________________________________________________________________________________________________________________________________________________________________________________________________
      const form = document.querySelector("form");
      form.addEventListener("submit", (event) => {
        // Lỗi thì ngưng chạy
        event.preventDefault();

        // B2: Lấy thông tin từ form
        const user = getDataForm();

        // B3: validate (kiểm tra thông tin rỗng, check confirm-password)
        const error = validate(user);
        if (error.status) {
          // render lỗi và kết thúc
          renderError(error);
          return;
        } else {
          // render không lỗi
        }

        // B4: Lấy data từ localStorage để kiểm tra trùng lặp

        const usersDB = JSON.parse(localStorage.getItem("users")) ?? [];

        //  B5: Kiểm tra email đã đăng ký chưa
        let isDulicate = false;
        usersDB.forEach((item) => {
          if (item.email === user.email) {
            isDulicate = true;
          }
        });

        if (isDulicate === false) {
          delete user.confirmPassword;
          user.name = "";
          user.date = "";
          user.add = "";
          user.phone = "";
          user.img = "";
          usersDB.push(user);

          //   B6: Đẩy dữ liệu lên localStorage
          localStorage.setItem("users", JSON.stringify(usersDB));
          //   Chuyển sang login

          window.location = "login.html";
        } else {
          error.status = true;
          error.errorMsg =
            "Email đã tồn tại, vui lòng đăng nhập hoặc đăng ký bằng một email khác";
          renderError(error);
        }
      });
      // ______________________________________________________________________________________________________________________________________________________________________________________________________
      //   Lấy data từ form
      function getDataForm() {
        const emailValue = document.querySelector("#email").value;
        const passwordValue = document.querySelector("#password").value;
        const confirmPasswordValue =
          document.querySelector("#confirm-password").value;
        return {
          email: emailValue.toLowerCase(),
          password: passwordValue,
          confirmPassword: confirmPasswordValue,
        };
      }

      //   validate info
      function validate(data) {
        let error = {
          status: false,
          errorMsg: "",
        };

        if (
          data.email == "" ||
          data.password == "" ||
          data.confirmPassword == ""
        ) {
          error.status = true;
          error.errorMsg = "Các thông tin không được để trống";
          return error;
        } else if (!(data.password === data.confirmPassword)) {
          error.status = true;
          error.errorMsg = "Mật khẩu nhập lại không chính xác";
          return error;
        } else if (data.password.length < 8) {
          error.status = true;
          error.errorMsg = "Mật khẩu không được ngắn hơn 8 ký tự";
          return error;
        } else if (
          !(
            data.password.match(/[a-z]/) &&
            data.password.match(/[A-Z]/) &&
            data.password.match(/\d/)
          )
        ) {
          error.status = true;
          error.errorMsg =
            "Mật khẩu cần bao gồm ký tự IN HOA, chữ thường và chữ số";
          return error;
        }

        //     // Check for mixed case
        //     if (data.password.match(/[a-z]/) && password.match(/[A-Z]/)) {
        //         strength += 1;
        //     } else {
        //         error.errorMsg= "Mật khẩu cần bao gồm ký tự viết hoa và viết thường";
        //     }

        //     // Check for numbers
        //     if (data.password.match(/\d/)) {
        //         strength += 1;
        //     } else {
        //         error.errorMsg= "Mật khẩu cần bao gồm ít nhất 1 chữ số";
        //     }

        //     // Check for special characters
        //     if (data.password.match(/[^a-zA-Z\d]/)) {
        //         strength += 1;
        //     } else {
        //         error.errorMsg= "Mật khẩu cần bao gồm ít nhất 1 ký tự đặc biệt ";
        //     }

        //     // Return results
        //     if (strength < 4) {
        // error.status = true
        // }
        //     }
        return error;
      }

      function renderError(error) {
        const errorValue = document.querySelector("#Error");
        errorValue.innerHTML = error.errorMsg;
      }

      function LoginPage() {
        window.location = "login.html";
      }

      function HomePage() {
        window.location = "index.html";
      }
    </script>
  </body>
</html>
